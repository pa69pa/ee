!function(e){var t=-1,a={"min-height":"1em",_height:"1em"},n=[16,17,18,20,27,225],s={},l={i:"&#xE23F;",b:"&#xE238;",l:"&#xE250;",seta:"&#xE15F;"};function i(t){t.on("cssanimationend animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){e(this).removeClass("ee-shadow-pulse")})}function o(t){var a=h(this),n=this.data("rootEE").ee;if(a.collapsed)return k.call(n.stat,s.w("s","Select anything please"),"sel"),!1;var l=e(t.target);l.data("eeFocus",null);var i=l.data("fortEE");d.call(this,a,i,i.pre)&&(a=window.getSelection().getRangeAt(0),this.data("rngEE",a),w.call(n.stat,""),n.statB.data("fortEE",i).data("eeFocus",this).fadeIn(),n.stat.attr("placeholder",i.pre).data("mType","GA"),f.call(this,a,i).className+=" ee-shadow-beacon",n.stat.focus());return!1}function r(t){var a=h(this);return a.collapsed?(k.call(this.data("rootEE").ee.stat,s.w("s","Select anything please"),"sel"),!1):d.call(this,a,e(t.target).data("fortEE"))}function d(e,t,a){var n=t.com;return null==n?c(e,t):document.execCommand("string"==typeof n?n:n[0],!1,a)?(this.data("rngEE",window.getSelection().getRangeAt(0)),!0):c(e,t)}function c(e,t){var a=t.tag,n=document.createElement(a);try{e.surroundContents(n)}catch(t){var s=e.cloneContents();null==s?n.innerHTML=e.toString():n.appendChild(s),e.deleteContents(),e.insertNode(n)}return!0}function u(t){var a=h(this),n=e(t.target).data("fortEE"),s=null;a.collapsed&&(s=f.call(this,a,n));var l=n.com;return null==l?g(a,null==s?f.call(this,a,n):s):!!document.execCommand("string"==typeof l?l:l[1],!1,null)||g(a,null==s?f.call(this,a,n):s)}function h(e){var t=e.data("rngEE");return null==t&&(t=window.getSelection().getRangeAt(0)),t}function f(t,a){var n=e(this).data("rngAP"),s=e(this).data("rngAT");null!=n&&null!=s&&0!=n.length&&0!=s.length||(n=[],s=[],C(t.startContainer.parentNode,n,s));var l=a.tag,i=e.inArray(l,s);return t.selectNode(n[i]),n[i]}function g(e,t){var a=document.createElement("div");a.innerHTML=t.innerHTML;for(var n,s=document.createDocumentFragment();n=a.firstChild;)s.appendChild(n);return e.deleteContents(),e.insertNode(s),!0}function p(t){var a,n;"string"==typeof t[0]?a=t[0]:(a=t[0][0],n=t[0][1]),a=e('<i class="ee-button">'+a+"</i>"),null!=n&&a.data("nameTog",n),null!=t[2]&&("string"==typeof t[2]?a.addClass(t[2]):a.css(t[2])),null!=t[3]?(a.data("fortEE",t[3]),null!=t[3].tag&&a.addClass("ee-tag"),null!=t[3].attr&&a.addClass("ee-attr"),null!=t[3].key&&("string"==typeof t[3].key?this.ee.ks.char.push([t[3].key,a]):(null==this.ee.ks[t[3].key[1]]&&(this.ee.ks[t[3].key[1]]=[]),this.ee.ks[t[3].key[1]].push([t[3].key[0],a])))):a.data("fortEE",{}),a.data("fortEE").func=t[1],a.appendTo(this.ee.menu);var s=this;return"function"==typeof t[1]?(a.mousedown(function(e){E.call(t[1],s,e)&&a.addClass("ee-shadow-pulse")}),i(a)):a.mousedown(function(e,t,a){this.hasClass("ee-toggle")?E.call(e[1],t,a)&&m.call(this,!1):E.call(e[0],t,a)&&m.call(this,!0)}.bind(a,t[1],s)),a.mouseup(function(e){e.preventDefault(),v()}),a}function m(e){e?this.addClass("ee-toggle"):this.removeClass("ee-toggle");var t=this.data("nameTog");null!=t&&(this.data("nameTog",this.text()),this.text(t))}function v(){var t=e(this).data("eeFocus");if(null!=t){t.focus();var a=t.data("rngEE");if(a){var n=window.getSelection();n.removeAllRanges(),n.addRange(a)}}e(this).data("eeFocus",null)}function E(t,a){a.preventDefault();var n=e(a.target);if(1==t.ee.es.length)return n.data("eeFocus",es[0]),this.call(t.ee.es[0],a);var l=null;return e.each(t.ee.es,function(e){if(this.is(":focus"))return l=this,!1}),null==l?(k.call(t.ee.stat,s.w("f","Set focus please"),"foc"),!1):(n.data("eeFocus",l),this.call(l,a))}function y(s,l){var i=e('<div class="ee-cel">');if(null!=s&&"null"!=s.slice(0,4)){var o=e('<div class="ee-row">');o.append('<div class="ee-cel name">'+s+"&nbsp;</div>").append(i),e('<div class="ee-tab">').append(o).appendTo(this)}else i.addClass("colspan").appendTo(this);var r=e('<div id="ee-edit'+t+this.ee.es.length+'" class="ee-edit" contenteditable />');r.appendTo(i),this.ee.es.push(r),null!=l?r.css(l):r.css(a),r.data("rootEE",this),r.focus(T.bind(this,"foc")),r.bind("keydown keyup mouseup",function(t){var a=e(this).data("rootEE").ee;if("keydown"!=t.type){if(!(e.inArray(t.keyCode,n)>-1))try{var s=window.getSelection().getRangeAt(0);e(this).data("rngEE",s);var l=[],i=[];if(C(s.startContainer.parentNode,l,i),e(this).data("rngAP",l),e(this).data("rngAT",i),0==i.length)e("i.ee-tag",a.menu).removeClass("ee-toggle"),T.call(a,null);else{var o=e(this);e("i.ee-tag",a.menu).each(function(t){var n=e(this).data("fortEE"),s=e.inArray(n.tag,i);s<0?(e(this).removeClass("ee-toggle"),T.call(a,null)):(e(this).addClass("ee-toggle"),n.attr?(a.statB.data("eeFocus",o).data("fortEE",n),w.call(a.stat,e(l[s]).attr(n.attr))):T.call(a,null))})}s.collapsed||T.call(a,"sel")}catch(t){console.log("ANYKEY err=",t)}}else{if(t.stopImmediatePropagation(),t.ctrlKey&&13==t.keyCode)return void document.execCommand("insertHTML",!1,"<br><br>");var r=!1;e.each(a.ks,function(e,a){if(t[e])for(var n=0;n<a.length;n++)if(t.keyCode==a[n][0])return a[n][1].mousedown(),t.preventDefault(),void(r=!0);if(r)return!1})}})}function C(e,t,a){var n=e.tagName;"DIV"!=n&&(t.push(e),a.push(n),C(e.parentNode,t,a))}function w(e){this.text(e).data("mType","TA").removeClass("mesg").addClass("attr")}function k(e,t){this.text("> "+e).data("mType",t).removeClass("attr").addClass("mesg").addClass("ee-shadow-pulse")}function T(t){var a=this.ee?this.ee:this;null!=t&&a.stat.data("mType")!=t||a.stat.text("").data("mType",null).removeClass("attr").removeClass("mesg").attr("placeholder",null),a.statB.fadeOut(),e(".ee-edit .ee-shadow-beacon").removeClass("ee-shadow-beacon")}"undefined"!=typeof setMNFontIcons&&setMNFontIcons(l),e.fn.makeEE=function(n){0==++t&&"undefined"!=typeof setMNLangs&&(s=setMNLangs("lib/langs/ee",["ru","en"])),"undefined"!=typeof getMNFontIcons&&getMNFontIcons(),this.addClass("ee-root");var c=e('<div class="ee-cel colspan menu">');if(c.appendTo(this),this.ee={menu:c,es:[],ks:{}},p.call(this,[l.i,[r,u],"mico",{key:[73,"ctrlKey"],tag:"I",com:"italic"}]),p.call(this,[l.b,[r,u],"mico",{key:[66,"ctrlKey"],tag:"B",com:"bold"}]),p.call(this,[l.l,[o,u],"mico",{key:[76,"ctrlKey"],tag:"A",attr:"href",pre:"http://",com:["createLink","unlink"]}]),null!=n){var h=this;e.each(n,function(e,t){"butt"==e.slice(0,4)?p.call(h,t):y.call(h,e,t)})}else y.call(this);var g=e('<div id="ee-edit'+t+this.ee.es.length+'" class="ee-stat" contenteditable />');g.css(a).focus(function(e){var t=this.ee.stat;if("TA"==t.data("mType")){var a=this.ee.statB;a.fadeIn();var n=a.data("eeFocus"),s=n.data("rngEE"),l=f.call(n,s,a.data("fortEE"));l.className+=" ee-shadow-beacon",t.data("mType",null),t.focus();var i=document.createRange();i.selectNode(t[0].firstChild),i.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(i)}}.bind(this)).appendTo(this),i(g),this.ee.stat=g;var m=e('<i class="ee-button ee-seta mico">'+l.seta+"</i>").css("display","none");return m.mousedown(function(t){t.preventDefault(),function(e){var t=this.data("eeFocus"),a=t.data("rootEE").ee,n=this.data("fortEE"),s=a.stat.text().trim();return null!=s&&""!=s&&(v.call(this),d.call(this,t.data("rngEE"),n,s))}.call(e(this),t)&&e(this).addClass("ee-shadow-pulse")}).mouseup(function(e){e.preventDefault()}).appendTo(this),i(m),this.ee.statB=m,g.bind("keydown",function(e){e.ctrlKey&&13==e.keyCode&&(m.mousedown(),e.preventDefault())}),this.ee.addButton=p.bind(this),this.ee.lang=s,this}}(jQuery);